package opennox

import (
	"math"

	"github.com/noxworld-dev/opennox-lib/types"
)

func nox_xxx_math_509ED0(p types.Pointf) int32 {
	v := int32((math.Atan2(float64(p.Y), float64(p.X))+6.2831855)*40.743664 + 0.5)
	return nox_xxx_math_roundDir(v)
}

func nox_xxx_math_roundDir(v int32) int32 {
	if v < 0 {
		v += int32(uint32(255-v) >> 8 << 8)
	}
	if v >= 256 {
		v -= int32(uint32(v) >> 8 << 8)
	}
	return v
}

func nox_xxx_math_roundDirI16(v int16) uint16 {
	if v < 0 {
		v += int16((uint32(255-v) >> 8) << 8)
	}
	if v >= 256 {
		v -= int16((uint32(v) >> 8) << 8)
	}
	return uint16(v)
}

func sincosDir(d byte) (cos, sin float32) { // 194136, 194140
	v := sincosDirTable[d]
	return v[0], v[1]
}

var sincosDirTable = [][2]float32{
	{1, 0},
	{0.9996988, 0.02454123},
	{0.99879545, 0.04906767},
	{0.99729043, 0.07356456},
	{0.9951847, 0.09801714},
	{0.9924795, 0.12241068},
	{0.9891765, 0.14673047},
	{0.98527765, 0.17096189},
	{0.98078525, 0.19509032},
	{0.9757021, 0.21910124},
	{0.97003126, 0.24298018},
	{0.96377605, 0.26671275},
	{0.95694035, 0.2902847},
	{0.94952816, 0.31368175},
	{0.94154406, 0.33688986},
	{0.9329928, 0.35989505},
	{0.9238795, 0.38268343},
	{0.9142098, 0.4052413},
	{0.9039893, 0.42755508},
	{0.8932243, 0.44961134},
	{0.88192123, 0.47139674},
	{0.87008697, 0.4928982},
	{0.8577286, 0.51410276},
	{0.8448536, 0.53499764},
	{0.8314696, 0.55557024},
	{0.8175848, 0.57580817},
	{0.8032075, 0.5956993},
	{0.7883464, 0.6152316},
	{0.77301043, 0.6343933},
	{0.7572088, 0.65317285},
	{0.7409511, 0.671559},
	{0.7242471, 0.68954057},
	{0.70710677, 0.70710677},
	{0.68954057, 0.7242471},
	{0.671559, 0.7409511},
	{0.65317285, 0.7572088},
	{0.6343933, 0.77301043},
	{0.6152316, 0.7883464},
	{0.5956993, 0.8032075},
	{0.57580817, 0.8175848},
	{0.55557024, 0.8314696},
	{0.53499764, 0.8448536},
	{0.51410276, 0.8577286},
	{0.4928982, 0.87008697},
	{0.47139674, 0.88192123},
	{0.44961134, 0.8932243},
	{0.42755508, 0.9039893},
	{0.4052413, 0.9142098},
	{0.38268343, 0.9238795},
	{0.35989505, 0.9329928},
	{0.33688986, 0.94154406},
	{0.31368175, 0.94952816},
	{0.2902847, 0.95694035},
	{0.26671275, 0.96377605},
	{0.24298018, 0.97003126},
	{0.21910124, 0.9757021},
	{0.19509032, 0.98078525},
	{0.17096189, 0.98527765},
	{0.14673047, 0.9891765},
	{0.12241068, 0.9924795},
	{0.09801714, 0.9951847},
	{0.07356456, 0.99729043},
	{0.04906767, 0.99879545},
	{0.02454123, 0.9996988},
	{0, 1},
	{-0.02454123, 0.9996988},
	{-0.04906767, 0.99879545},
	{-0.07356456, 0.99729043},
	{-0.09801714, 0.9951847},
	{-0.12241068, 0.9924795},
	{-0.14673047, 0.9891765},
	{-0.17096189, 0.98527765},
	{-0.19509032, 0.98078525},
	{-0.21910124, 0.9757021},
	{-0.24298018, 0.97003126},
	{-0.26671275, 0.96377605},
	{-0.2902847, 0.95694035},
	{-0.31368175, 0.94952816},
	{-0.33688986, 0.94154406},
	{-0.35989505, 0.9329928},
	{-0.38268343, 0.9238795},
	{-0.4052413, 0.9142098},
	{-0.42755508, 0.9039893},
	{-0.44961134, 0.8932243},
	{-0.47139674, 0.88192123},
	{-0.4928982, 0.87008697},
	{-0.51410276, 0.8577286},
	{-0.53499764, 0.8448536},
	{-0.55557024, 0.8314696},
	{-0.57580817, 0.8175848},
	{-0.5956993, 0.8032075},
	{-0.6152316, 0.7883464},
	{-0.6343933, 0.77301043},
	{-0.65317285, 0.7572088},
	{-0.671559, 0.7409511},
	{-0.68954057, 0.7242471},
	{-0.70710677, 0.70710677},
	{-0.7242471, 0.68954057},
	{-0.7409511, 0.671559},
	{-0.7572088, 0.65317285},
	{-0.77301043, 0.6343933},
	{-0.7883464, 0.6152316},
	{-0.8032075, 0.5956993},
	{-0.8175848, 0.57580817},
	{-0.8314696, 0.55557024},
	{-0.8448536, 0.53499764},
	{-0.8577286, 0.51410276},
	{-0.87008697, 0.4928982},
	{-0.88192123, 0.47139674},
	{-0.8932243, 0.44961134},
	{-0.9039893, 0.42755508},
	{-0.9142098, 0.4052413},
	{-0.9238795, 0.38268343},
	{-0.9329928, 0.35989505},
	{-0.94154406, 0.33688986},
	{-0.94952816, 0.31368175},
	{-0.95694035, 0.2902847},
	{-0.96377605, 0.26671275},
	{-0.97003126, 0.24298018},
	{-0.9757021, 0.21910124},
	{-0.98078525, 0.19509032},
	{-0.98527765, 0.17096189},
	{-0.9891765, 0.14673047},
	{-0.9924795, 0.12241068},
	{-0.9951847, 0.09801714},
	{-0.99729043, 0.07356456},
	{-0.99879545, 0.04906767},
	{-0.9996988, 0.02454123},
	{-1, 0},
	{-0.9996988, -0.02454123},
	{-0.99879545, -0.04906767},
	{-0.99729043, -0.07356456},
	{-0.9951847, -0.09801714},
	{-0.9924795, -0.12241068},
	{-0.9891765, -0.14673047},
	{-0.98527765, -0.17096189},
	{-0.98078525, -0.19509032},
	{-0.9757021, -0.21910124},
	{-0.97003126, -0.24298018},
	{-0.96377605, -0.26671275},
	{-0.95694035, -0.2902847},
	{-0.94952816, -0.31368175},
	{-0.94154406, -0.33688986},
	{-0.9329928, -0.35989505},
	{-0.9238795, -0.38268343},
	{-0.9142098, -0.4052413},
	{-0.9039893, -0.42755508},
	{-0.8932243, -0.44961134},
	{-0.88192123, -0.47139674},
	{-0.87008697, -0.4928982},
	{-0.8577286, -0.51410276},
	{-0.8448536, -0.53499764},
	{-0.8314696, -0.55557024},
	{-0.8175848, -0.57580817},
	{-0.8032075, -0.5956993},
	{-0.7883464, -0.6152316},
	{-0.77301043, -0.6343933},
	{-0.7572088, -0.65317285},
	{-0.7409511, -0.671559},
	{-0.7242471, -0.68954057},
	{-0.70710677, -0.70710677},
	{-0.68954057, -0.7242471},
	{-0.671559, -0.7409511},
	{-0.65317285, -0.7572088},
	{-0.6343933, -0.77301043},
	{-0.6152316, -0.7883464},
	{-0.5956993, -0.8032075},
	{-0.57580817, -0.8175848},
	{-0.55557024, -0.8314696},
	{-0.53499764, -0.8448536},
	{-0.51410276, -0.8577286},
	{-0.4928982, -0.87008697},
	{-0.47139674, -0.88192123},
	{-0.44961134, -0.8932243},
	{-0.42755508, -0.9039893},
	{-0.4052413, -0.9142098},
	{-0.38268343, -0.9238795},
	{-0.35989505, -0.9329928},
	{-0.33688986, -0.94154406},
	{-0.31368175, -0.94952816},
	{-0.2902847, -0.95694035},
	{-0.26671275, -0.96377605},
	{-0.24298018, -0.97003126},
	{-0.21910124, -0.9757021},
	{-0.19509032, -0.98078525},
	{-0.17096189, -0.98527765},
	{-0.14673047, -0.9891765},
	{-0.12241068, -0.9924795},
	{-0.09801714, -0.9951847},
	{-0.07356456, -0.99729043},
	{-0.04906767, -0.99879545},
	{-0.02454123, -0.9996988},
	{0, -1},
	{0.02454123, -0.9996988},
	{0.04906767, -0.99879545},
	{0.07356456, -0.99729043},
	{0.09801714, -0.9951847},
	{0.12241068, -0.9924795},
	{0.14673047, -0.9891765},
	{0.17096189, -0.98527765},
	{0.19509032, -0.98078525},
	{0.21910124, -0.9757021},
	{0.24298018, -0.97003126},
	{0.26671275, -0.96377605},
	{0.2902847, -0.95694035},
	{0.31368175, -0.94952816},
	{0.33688986, -0.94154406},
	{0.35989505, -0.9329928},
	{0.38268343, -0.9238795},
	{0.4052413, -0.9142098},
	{0.42755508, -0.9039893},
	{0.44961134, -0.8932243},
	{0.47139674, -0.88192123},
	{0.4928982, -0.87008697},
	{0.51410276, -0.8577286},
	{0.53499764, -0.8448536},
	{0.55557024, -0.8314696},
	{0.57580817, -0.8175848},
	{0.5956993, -0.8032075},
	{0.6152316, -0.7883464},
	{0.6343933, -0.77301043},
	{0.65317285, -0.7572088},
	{0.671559, -0.7409511},
	{0.68954057, -0.7242471},
	{0.70710677, -0.70710677},
	{0.7242471, -0.68954057},
	{0.7409511, -0.671559},
	{0.7572088, -0.65317285},
	{0.77301043, -0.6343933},
	{0.7883464, -0.6152316},
	{0.8032075, -0.5956993},
	{0.8175848, -0.57580817},
	{0.8314696, -0.55557024},
	{0.8448536, -0.53499764},
	{0.8577286, -0.51410276},
	{0.87008697, -0.4928982},
	{0.88192123, -0.47139674},
	{0.8932243, -0.44961134},
	{0.9039893, -0.42755508},
	{0.9142098, -0.4052413},
	{0.9238795, -0.38268343},
	{0.9329928, -0.35989505},
	{0.94154406, -0.33688986},
	{0.94952816, -0.31368175},
	{0.95694035, -0.2902847},
	{0.96377605, -0.26671275},
	{0.97003126, -0.24298018},
	{0.9757021, -0.21910124},
	{0.98078525, -0.19509032},
	{0.98527765, -0.17096189},
	{0.9891765, -0.14673047},
	{0.9924795, -0.12241068},
	{0.9951847, -0.09801714},
	{0.99729043, -0.07356456},
	{0.99879545, -0.04906767},
	{0.9996988, -0.02454123},
}
